#!/usr/bin/env python3
"""
Script para analisar PDFs baseado no conte√∫do visual j√° dispon√≠vel
"""

def analisar_nf_m4x():
    """
    An√°lise da NF 17 - M4X baseada no conte√∫do visual
    """
    print("="*60)
    print("AN√ÅLISE: NF 17 - M4X - PJ - VENC 01.08.pdf")
    print("="*60)
    
    print("\nüèõÔ∏è IDENTIFICA√á√ÉO DO EMISSOR:")
    print("‚Ä¢ Estado/Munic√≠pio: S√£o Paulo - SP")
    print("‚Ä¢ √ìrg√£o: PREFEITURA DO MUNIC√çPIO DE S√ÉO PAULO")
    print("‚Ä¢ Sistema: NFS-e (Nota Fiscal Eletr√¥nica de Servi√ßos)")
    
    print("\nüìã DADOS DA NOTA:")
    print("‚Ä¢ N√∫mero da Nota: 00000017")
    print("‚Ä¢ Data e Hora de Emiss√£o: 01/08/2025 09:01:39")
    print("‚Ä¢ C√≥digo de Verifica√ß√£o: 2RED-BDYN")
    print("‚Ä¢ RPS N¬∫: 17, emitido em 01/08/2025")
    
    print("\nüë§ PRESTADOR DE SERVI√áOS:")
    print("‚Ä¢ CPF/CNPJ: 54.748.959/0001-60")
    print("‚Ä¢ Nome/Raz√£o Social: M4X CONSULTORIA LTDA")
    print("‚Ä¢ Endere√ßo: R CACONDE 49, APT 21 - JARDIM PAULISTA - CEP: 01425-011")
    print("‚Ä¢ Munic√≠pio: S√£o Paulo - SP")
    print("‚Ä¢ Inscri√ß√£o Municipal: 1.316.641-7")
    
    print("\nüè¢ TOMADOR DE SERVI√áOS:")
    print("‚Ä¢ Nome/Raz√£o Social: ALFA ENTRETENIMENTO S.A.")
    print("‚Ä¢ CPF/CNPJ: 55.369.927/0001-04")
    print("‚Ä¢ Endere√ßo: R TEODORO SAMPAIO 744, CONJ 108 - PINHEIROS - CEP: 05406-000")
    print("‚Ä¢ Munic√≠pio: S√£o Paulo - SP")
    print("‚Ä¢ E-mail: -----")
    print("‚Ä¢ Inscri√ß√£o Municipal: 1.376.096-6")
    
    print("\nüí∞ VALORES FISCAIS:")
    print("‚Ä¢ Valor Total do Servi√ßo: R$ 69.888,00")
    print("‚Ä¢ Base de C√°lculo (R$): 69.888,00")
    print("‚Ä¢ Al√≠quota (%): 5,00%")
    print("‚Ä¢ Valor do ISS (R$): 3.494,40")
    print("‚Ä¢ Cr√©dito (R$): 0,00")
    print("‚Ä¢ INSS: -")
    print("‚Ä¢ IRRF: 1.048,32")
    print("‚Ä¢ CSLL: 698,88")
    print("‚Ä¢ COFINS: 2.096,64")
    print("‚Ä¢ PIS/PASEP: 454,27")
    
    print("\nüîñ C√ìDIGO DO SERVI√áO:")
    print("‚Ä¢ C√≥digo: 03116")
    print("‚Ä¢ Descri√ß√£o: Assessoria ou consultoria de qualquer natureza, n√£o contida em outros itens desta lista.")
    
    print("\nüìù DISCRIMINA√á√ÉO DOS SERVI√áOS:")
    print("‚Ä¢ PRESTA√á√ÉO DE SERVI√áOS DE CONSULTORIA")
    print("‚Ä¢ VALOR L√çQUIDO: R$ 65.589,89")
    print("‚Ä¢ Vencimento: 07/08/2025")
    
    print("\nüìä TRIBUTOS:")
    print("‚Ä¢ Valor Aprovimado dos Tributos / Fonte: R$ 11.412,71 (16,33%) / IBPT")
    
    print("\nüîç PADR√ïES √öNICOS IDENTIFICADOS:")
    print("‚Ä¢ Layout padr√£o S√£o Paulo com tabela de valores detalhada")
    print("‚Ä¢ Campo 'Vencimento' na se√ß√£o de discrimina√ß√£o")
    print("‚Ä¢ M√∫ltiplos tributos federais (IRRF, CSLL, COFINS, PIS/PASEP)")
    print("‚Ä¢ C√≥digo de verifica√ß√£o alfanum√©rico (2RED-BDYN)")
    print("‚Ä¢ RPS com numera√ß√£o simples (17)")
    print("‚Ä¢ Valor aproximado de tributos com refer√™ncia IBPT")

def analisar_nf_jnto():
    """
    An√°lise da NF 282 - JNTO AD.EZ baseada no conte√∫do visual
    """
    print("\n" + "="*60)
    print("AN√ÅLISE: NF 282 - JNTO AD.EZ - VENC 25.08.pdf")
    print("="*60)
    
    print("\nüèõÔ∏è IDENTIFICA√á√ÉO DO EMISSOR:")
    print("‚Ä¢ Estado/Munic√≠pio: S√£o Paulo - SP")
    print("‚Ä¢ √ìrg√£o: PREFEITURA DO MUNIC√çPIO DE S√ÉO PAULO")
    print("‚Ä¢ Sistema: NFS-e (Nota Fiscal Eletr√¥nica de Servi√ßos)")
    
    print("\nüìã DADOS DA NOTA:")
    print("‚Ä¢ N√∫mero da Nota: 00000282")
    print("‚Ä¢ Data e Hora de Emiss√£o: 14/08/2025 15:36:48")
    print("‚Ä¢ C√≥digo de Verifica√ß√£o: LUJB-BQE8")
    
    print("\nüë§ PRESTADOR DE SERVI√áOS:")
    print("‚Ä¢ CPF/CNPJ: 44.524.280/0001-02")
    print("‚Ä¢ Nome/Raz√£o Social: JNTO AD EZ COMUNICACAO LTDA")
    print("‚Ä¢ Endere√ßo: R MOURATO COELHO 90, SALA 83 - PINHEIROS - CEP: 05417-000")
    print("‚Ä¢ Munic√≠pio: S√£o Paulo - SP")
    print("‚Ä¢ Inscri√ß√£o Municipal: 7.164.253-1")
    
    print("\nüè¢ TOMADOR DE SERVI√áOS:")
    print("‚Ä¢ Nome/Raz√£o Social: ALFA ENTRETENIMENTO S.A.")
    print("‚Ä¢ CPF/CNPJ: 55.369.927/0001-04")
    print("‚Ä¢ Endere√ßo: R TEODORO SAMPAIO 744, CONJ 108 - PINHEIROS - CEP: 05406-000")
    print("‚Ä¢ Munic√≠pio: S√£o Paulo - SP")
    print("‚Ä¢ E-mail: -----")
    print("‚Ä¢ Inscri√ß√£o Municipal: 1.376.096-6")
    
    print("\nüìù DISCRIMINA√á√ÉO DOS SERVI√áOS:")
    print("‚Ä¢ Presta√ß√£o de Servi√ßos")
    print("‚Ä¢ Descri√ß√£o: 142 FTDs")
    print("‚Ä¢ DADOS BANC√ÅRIOS:")
    print("  - BANCO: Santander (033)")
    print("  - AG: 2006")
    print("  - CC: 13002021-7")
    print("  - VENCIMENTO: 18/08/2025")
    print("‚Ä¢ Observa√ß√£o sobre reten√ß√£o de 1.5% de IRRF e Instru√ß√£o Normativa SRF n¬∫ 123/92")
    
    print("\nüí∞ VALORES FISCAIS:")
    print("‚Ä¢ Valor Total do Servi√ßo: R$ 15.620,00")
    print("‚Ä¢ Base de C√°lculo (R$): 15.620,00")
    print("‚Ä¢ Al√≠quota (%): 5,00%")
    print("‚Ä¢ Valor do ISS (R$): 781,00")
    print("‚Ä¢ Cr√©dito (R$): 0,00")
    print("‚Ä¢ INSS, IRRF, CSLL, COFINS, PIS/PASEP: -")
    
    print("\nüîñ C√ìDIGO DO SERVI√áO:")
    print("‚Ä¢ C√≥digo: 02496")
    print("‚Ä¢ Descri√ß√£o: Propaganda e publicidade, promo√ß√£o de vendas, planejamento de campanhas e materiais publicit√°rios.")
    
    print("\nüîç PADR√ïES √öNICOS IDENTIFICADOS:")
    print("‚Ä¢ Layout padr√£o S√£o Paulo simplificado")
    print("‚Ä¢ Se√ß√£o de dados banc√°rios detalhada na discrimina√ß√£o")
    print("‚Ä¢ Refer√™ncia a FTDs (unidade de medida espec√≠fica)")
    print("‚Ä¢ C√≥digo de verifica√ß√£o alfanum√©rico (LUJB-BQE8)")
    print("‚Ä¢ Observa√ß√µes sobre reten√ß√µes e instru√ß√£o normativa")
    print("‚Ä¢ Apenas ISS como tributo municipal")
    print("‚Ä¢ Vencimento dentro da discrimina√ß√£o dos servi√ßos")

def gerar_resumo_padroes():
    """
    Gera resumo dos padr√µes encontrados para atualiza√ß√£o do analisador
    """
    print("\n" + "="*80)
    print("RESUMO DE PADR√ïES PARA ATUALIZA√á√ÉO DO ANALISADOR")
    print("="*80)
    
    print("\nüîß MELHORIAS NECESS√ÅRIAS:")
    
    print("\n1. EXTRA√á√ÉO DE TEXTO:")
    print("   ‚Ä¢ Problema: PDFs com encoding problem√°tico (cid characters)")
    print("   ‚Ä¢ Solu√ß√£o: Implementar OCR como fallback ou usar diferentes m√©todos de extra√ß√£o")
    
    print("\n2. PADR√ïES S√ÉO PAULO:")
    print("   ‚Ä¢ Valor Total: padr√£o 'VALOR TOTAL DO SERVI√áO = R$ X.XXX,XX'")
    print("   ‚Ä¢ Base de C√°lculo: buscar em tabela ap√≥s 'Valor Total das Dedu√ß√µes'")
    print("   ‚Ä¢ ISS: buscar 'Valor do ISS (R$)' na tabela de valores")
    print("   ‚Ä¢ Al√≠quota: buscar 'Al√≠quota (%)' na tabela")
    print("   ‚Ä¢ C√≥digo de Verifica√ß√£o: formatos 'XXXX-XXXX' alfanum√©ricos")
    
    print("\n3. CAMPOS ESPEC√çFICOS:")
    print("   ‚Ä¢ Vencimento pode estar na discrimina√ß√£o dos servi√ßos")
    print("   ‚Ä¢ Dados banc√°rios podem estar na discrimina√ß√£o")
    print("   ‚Ä¢ M√∫ltiplos tributos federais (IRRF, CSLL, COFINS, PIS/PASEP)")
    print("   ‚Ä¢ Campo 'Valor Aproximado dos Tributos' com refer√™ncia IBPT")
    
    print("\n4. C√ìDIGOS DE SERVI√áO:")
    print("   ‚Ä¢ 03116: Assessoria/consultoria")
    print("   ‚Ä¢ 02496: Propaganda e publicidade")
    
    print("\n5. REGEX PATTERNS SUGERIDOS:")
    print("   ‚Ä¢ Valor Total: r'VALOR TOTAL DO SERVI√áO = R\\$ ([\\d.,]+)'")
    print("   ‚Ä¢ ISS: r'Valor do ISS \\(R\\$\\)\\s*([\\d.,]+)'")
    print("   ‚Ä¢ Al√≠quota: r'Al√≠quota \\(%\\)\\s*([\\d.,]+)'")
    print("   ‚Ä¢ Base C√°lculo: r'Base de C√°lculo \\(R\\$\\)\\s*([\\d.,]+)'")
    print("   ‚Ä¢ C√≥digo Verif: r'C√≥digo de Verifica√ß√£o\\s*([A-Z0-9]{4}-[A-Z0-9]{4})'")
    print("   ‚Ä¢ Vencimento: r'(?:Vencimento|VENCIMENTO):\\s*(\\d{2}/\\d{2}/\\d{4})'")

def main():
    analisar_nf_m4x()
    analisar_nf_jnto()
    gerar_resumo_padroes()
    
    print("\n" + "="*80)
    print("AN√ÅLISE CONCLU√çDA")
    print("="*80)
    print("Os padr√µes identificados podem ser usados para atualizar o analisador_nf.py")

if __name__ == "__main__":
    main()